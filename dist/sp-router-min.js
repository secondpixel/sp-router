class SPRouter{constructor(e={}){this._body=document.querySelector("body"),this._currentUrl=window.location.href,this._baseUrl=document.querySelector("meta[name='base_url']").content,this._routeDelimiter="#",this._segmentSplitter=":",this._params=e,this._routes=e.routes,this._content=document.querySelector(e.content),this._defaultRoute=Json.hasProps(e,"defaultRoute")?e.defaultRoute:"/",e.loader&&(this._loader={_loaderSelector:document.querySelector(e.loader.selector),_loaderShow:e.loader.showClass?e.loader.showClass:null}),e.lazy?this._lazy={_loading:e.lazy.loading,_duration:e.lazy.duration?e.lazy.duration:500}:this._lazy={_loading:!1},this._ajax=new Ajax,this._element=new Element(this),this.initRoute(),this.initLinks()}getUrl(){return this._currentUrl}getBaseUrl(){return this._baseUrl}initRoute(){let e=this._currentUrl.replace(this._baseUrl,"");this._routeString=null!=e&&""!=e?e:this._defaultRoute,this.setRoute(this._routeString,null)}setRoute(e,t=null){let r=this,s=Helpers.characterCheckRemove(e,r._routeDelimiter);return r._route=r.extractRoute(s),r._route&&(r._segmentsStorage=r.extractSegments(e),r.loader(!0),this._ajax.getView(r._route.template,function(e){r._view=e,r._content.innerHTML=r._view,r._element.scriptInit(r._route.script),r.initLinks(),document.title=r._route.title,window.history.pushState({html:r._view,pageTitle:r._route.title},"",r._baseUrl+("/"==s?"":r._routeDelimiter+s)),r.loader(!1)})),!1}extractRoute(e){let t=null;if(this._routes.length>0)return(t=this.findRoute(e))||(t=this.findRoute(this._defaultRoute)),t;throw new Error("Routes must be defined. Please define some routes.")}findRoute(e){let t=this.decodeRoutes(e);for(var r=0;r<this._routes.length;r++){let e=this._routes[r],s=e.route,o=Helpers.numCharactes(s,this._segmentSplitter),l=this.decodeRoutes(s),i=l.length-o,n=this.routeDefiner(l);if(l.length==t.length){let r=0;if(l.map((e,s)=>{let o=n[s],l=t[s];o||e!=l||r++}),i==r)return e}}return!1}decodeRoutes(e){return e.split("/").slice(1)}isSegment(e){return Helpers.characterCheck(e,this._segmentSplitter)}numSegments(e){return Helpers.numCharactes(e,this._segmentSplitter)}routeDefiner(e){let t=this,r={};return e.map((e,s)=>{t.isSegment(e)?r[s]=!0:r[s]=!1}),r}extractSegments(e){let t=this,r=t._route.route,s=t.decodeRoutes(e),o=t.decodeRoutes(r),l={};return t.numSegments(r)>0&&o.map((e,r)=>{let o=s[r];if(t.isSegment(e)){let r=e.replace(t._segmentSplitter,"");l['"'+r+'"']=o}}),l}segment(e){return this._segmentsStorage['"'+e+'"']}initLinks(){let e=this,t=document.querySelectorAll("a");t.length>0&&t.forEach(function(t){t.onclick||(t.onclick=function(t){e.clickEvent(t,this)})})}clickEvent(e,t){return this.setRoute(t.getAttribute("href"),t),e.stopPropagation(),e.preventDefault(),!1}loader(e){let t=this,r=!!t._loader._loaderShow;!t._lazy._loading||e?t.loaderWorker(r,e):setTimeout(function(){t.loaderWorker(r,e)},t._lazy._duration)}loaderWorker(e,t){switch(t){case!0:e?this._loader._loaderSelector.classList.remove(this._loader._loaderShow):this._loader._loaderSelector.style.display="block",this._content.style.display="none";break;case!1:e?this._loader._loaderSelector.classList.add(this._loader._loaderShow):this._loader._loaderSelector.style.display="none",this._content.removeAttribute("style")}}}class Ajax{ajax(e={}){let t=new XMLHttpRequest,r=null;t.onreadystatechange=function(){4==this.readyState&&200==this.status&&e.success(t.responseText)},t.open(e.type,e.url,!e.async||e.async),"POST"==e.type&&(r=Json.sObject(e.data)),t.send(r)}getView(e,t){this.ajax({type:"GET",url:e,success:function(e){t(e)}})}}class Json{static sObject(e){let t="";for(let r in e)""!=t&&(t+="&"),t+=r+"="+encodeURIComponent(e[r]);return t}static hasProps(e,t){return!(!e[t]||""==e[t])}}class Element{constructor(e){this._router=e}scriptInit(e){let t=this._router;document.querySelectorAll("script").forEach(function(e){e.getAttribute("src")==t._ls&&e.parentNode.removeChild(e)}),t._body.appendChild(this.createScript(e)),t._ls=e}createScript(e){let t=document.createElement("script");return t.src=e,t}}class Helpers{static characterCheck(e,t){return e.indexOf(t)>-1}static numCharactes(e,t){return(e.match(RegExp(t,"g"))||[]).length}static characterCheckRemove(e,t){return this.characterCheck(e,t)&&(e=e.replace(t,"")),e}}