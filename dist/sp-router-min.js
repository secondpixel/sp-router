class SPRouter{constructor(e={}){this._body=document.querySelector("body"),this._currentUrl=window.location.href,this._baseUrl=document.querySelector("meta[name='base_url']").content,this._routeDelimiter="#",this._segmentSplitter=":",this._params=e,this._routes=e.routes,this._content=document.querySelector(e.content),this._defaultRoute=this.hasProps(e,"defaultRoute")?e.defaultRoute:"/",e.loader&&(this._loader={_loaderSelector:document.querySelector(e.loader.selector),_loaderShow:e.loader.showClass?e.loader.showClass:null}),e.lazy?this._lazy={_loading:e.lazy.loading,_duration:e.lazy.duration?e.lazy.duration:500}:this._lazy={_loading:!1},this.initRoute(),this.initLinks()}getUrl(){return this._currentUrl}getBaseUrl(){return this._baseUrl}initRoute(){var e=this._currentUrl.replace(this._baseUrl,"");this._routeString=null!=e&&""!=e?e:this._defaultRoute,this.setRoute(this._routeString,null)}setRoute(e,t=null){var r=this,s=r.characterCheckRemove(e,r._routeDelimiter);return r._route=r.extractRoute(s),r._route&&(r._segmentsStorage=r.extractSegments(e),r.loader(!0),r.getView(r._route.template,function(e){r._view=e,r._content.innerHTML=r._view,r.scriptInit(r._route.script),r.initLinks(),document.title=r._route.title,window.history.pushState({html:r._view,pageTitle:r._route.title},"",r._baseUrl+("/"==s?"":r._routeDelimiter+s)),r.loader(!1)})),!1}getView(e,t){this.ajax({type:"GET",url:e,success:function(e){t(e)}})}extractRoute(e){var t=null;if(this._routes.length>0)return(t=this.findRoute(e))||(t=this.findRoute(this._defaultRoute)),t;throw new Error("Routes must be defined. Please define some routes.")}ajax(e={}){var t=new XMLHttpRequest,r=null;t.onreadystatechange=function(){4==this.readyState&&200==this.status&&e.success(t.responseText)},t.open(e.type,e.url,!e.async||e.async),"POST"==e.type&&(r=this.sObject(e.data)),t.send(r)}scriptInit(e){var t=this;document.querySelectorAll("script").forEach(function(e){e.getAttribute("src")==t._ls&&e.parentNode.removeChild(e)}),t._body.appendChild(t.createScript(e)),t._ls=e}createScript(e){var t=document.createElement("script");return t.src=e,t}characterCheck(e,t){return e.indexOf(t)>-1}numCharactes(e,t){return(e.match(RegExp(t,"g"))||[]).length}characterCheckRemove(e,t){return this.characterCheck(e,t)&&(e=e.replace(t,"")),e}hasProps(e,t){return!(!e[t]||""==e[t])}sObject(e){var t="";for(var r in e)""!=t&&(t+="&"),t+=r+"="+encodeURIComponent(e[r]);return t}findRoute(e){for(var t=this.decodeRoutes(e),r=0;r<this._routes.length;r++){var s=this._routes[r],o=s.route,i=this.numCharactes(o,":"),n=this.decodeRoutes(o),a=n.length-i,l=this.routeDefiner(n);if(n.length==t.length){for(var u=0,c=0;c<n.length;c++){var h=n[c],d=l[c],_=t[c];d||h!=_||u++}if(a==u)return s}}return!1}decodeRoutes(e){return e.split("/").slice(1)}isSegment(e){return this.characterCheck(e,this._segmentSplitter)}numSegments(e){return this.numCharactes(e,this._segmentSplitter)}routeDefiner(e){for(var t={},r=0;r<e.length;r++){var s=e[r];this.isSegment(s)?t[r]=!0:t[r]=!1}return t}extractSegments(e){var t=this._route.route,r=this.decodeRoutes(e),s=this.decodeRoutes(t),o={};if(this.numSegments(t)>0)for(var i=0;i<s.length;i++){var n=s[i],a=r[i];if(this.isSegment(n))o['"'+n.replace(this._segmentSplitter,"")+'"']=a}return o}segment(e){return this._segmentsStorage['"'+e+'"']}initLinks(){var e=this,t=document.querySelectorAll("a");t.length>0&&t.forEach(function(t){t.onclick||(t.onclick=function(t){e.clickEvent(t,this)})})}clickEvent(e,t){return this.setRoute(t.getAttribute("href"),t),e.stopPropagation(),e.preventDefault(),!1}loader(e){var t=this,r=!!t._loader._loaderShow;!t._lazy._loading||e?t.loaderWorker(r,e):setTimeout(function(){t.loaderWorker(r,e)},t._lazy._duration)}loaderWorker(e,t){switch(t){case!0:e?this._loader._loaderSelector.classList.remove(this._loader._loaderShow):this._loader._loaderSelector.style.display="block",this._content.style.display="none";break;case!1:e?this._loader._loaderSelector.classList.add(this._loader._loaderShow):this._loader._loaderSelector.style.display="none",this._content.removeAttribute("style")}}}