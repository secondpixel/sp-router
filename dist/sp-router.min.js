"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var SPRouter=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t),this._body=document.querySelector("body"),this._currentUrl=window.location.href,this._baseUrl=document.querySelector("meta[name='base_url']").content,this._routeDelimiter="#",this._segmentSplitter=":",this._slashDelimiter="/",this._routes=e.routes,this._content=document.querySelector(e.content),this._defaultRoute=Json.hasProps(e,"defaultRoute")?e.defaultRoute:"/",this._hashtag=void 0===e.hashtag||e.hashtag,this._contentLoadHide=!0,e.loader&&(this._loader={_loaderSelector:document.querySelector(e.loader.selector),_loaderShow:e.loader.showHideClass?e.loader.showHideClass:null},this._contentLoadHide=void 0===e.loader.loadContentHide||e.loader.loadContentHide),e.lazy?this._lazy={_loading:e.lazy.loading,_duration:e.lazy.duration?e.lazy.duration:500}:this._lazy={_loading:!1},this._ajax=new Ajax,this._element=new Element(this),this.initRoute(),this.initLinks()}return _createClass(t,[{key:"getUrl",value:function(){return this._currentUrl}},{key:"getBaseUrl",value:function(){return this._baseUrl}},{key:"initRoute",value:function(){var e=this._currentUrl.replace(this._baseUrl,"");this._routeString=null!=e&&""!=e?e:this._defaultRoute,this.setRoute(this._routeString,null)}},{key:"setRoute",value:function(e){1<arguments.length&&void 0!==arguments[1]&&arguments[1];var t=this,n=t._slashDelimiter+Helpers.characterCheckRemove(Helpers.slashRemove(e),t._routeDelimiter),r=t._hashtag?t._routeDelimiter+n:n;return t._route=t.extractRoute(n),t._route&&(t._segmentsStorage=t.extractSegments(e),t.loader(!0),this._ajax.getView(t._route.template,function(e){t._view=e,t._content.innerHTML=t._view,t._element.scriptInit(t._route.script),t.initLinks(),document.title=t._route.title,window.history.pushState({html:t._view,pageTitle:t._route.title},"",t._baseUrl+("/"==n?"":r)),t.loader(!1)})),!1}},{key:"extractRoute",value:function(e){var t=null;if(0<this._routes.length)return(t=this.findRoute(e))||(t=this.findRoute(this._defaultRoute)),t;throw new Error("Routes must be defined. Please define some routes.")}},{key:"findRoute",value:function(e){for(var s=this,l=this.decodeRoutes(e),t=function(){var e=s._routes[u],t=e.route,n=Helpers.numCharactes(t,s._segmentSplitter),r=s.decodeRoutes(t),o=r.length-n,i=s.routeDefiner(r);if(r.length==l.length){var a=0;if(r.map(function(e,t){var n=i[t],r=l[t];n||e!=r||a++}),o==a)return{v:e}}},u=0;u<this._routes.length;u++){var n=t();if("object"===(void 0===n?"undefined":_typeof(n)))return n.v}return!1}},{key:"decodeRoutes",value:function(e){return e.split("/").slice(1)}},{key:"isSegment",value:function(e){return Helpers.characterCheck(e,this._segmentSplitter)}},{key:"numSegments",value:function(e){return Helpers.numCharactes(e,this._segmentSplitter)}},{key:"routeDefiner",value:function(e){var n=this,r={};return e.map(function(e,t){n.isSegment(e)?r[t]=!0:r[t]=!1}),r}},{key:"extractSegments",value:function(e){var o=this,t=o._route.route,i=o.decodeRoutes(e),n=o.decodeRoutes(t),a={};return 0<o.numSegments(t)&&n.map(function(e,t){var n=i[t];if(o.isSegment(e)){var r=e.replace(o._segmentSplitter,"");a['"'+r+'"']=n}}),a}},{key:"segment",value:function(e){return this._segmentsStorage['"'+e+'"']}},{key:"initLinks",value:function(){var t=this,e=document.querySelectorAll("a");0<e.length&&e.forEach(function(e){e.onclick||(e.onclick=function(e){t.clickEvent(e,this)})})}},{key:"clickEvent",value:function(e,t){return this.setRoute(t.getAttribute("href"),t),e.stopPropagation(),e.preventDefault(),!1}},{key:"loader",value:function(e){var t=this,n=!!t._loader._loaderShow;!t._lazy._loading||e?t.loaderWorker(n,e):setTimeout(function(){t.loaderWorker(n,e)},t._lazy._duration)}},{key:"loaderWorker",value:function(e,t){switch(t){case!0:e?this._loader._loaderSelector.classList.remove(this._loader._loaderShow):this._contentLoadHide&&(this._loader._loaderSelector.style.display="block"),this._contentLoadHide&&(this._content.style.display="none");break;case!1:e?this._loader._loaderSelector.classList.add(this._loader._loaderShow):this._contentLoadHide&&(this._loader._loaderSelector.style.display="none"),this._contentLoadHide&&this._content.removeAttribute("style")}}}]),t}(),Ajax=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"ajax",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=new XMLHttpRequest,n=null;t.onreadystatechange=function(){4==this.readyState&&200==this.status&&e.success(t.responseText)},t.open(e.type,e.url,!e.async||e.async),"POST"==e.type&&(n=Json.sObject(e.data)),t.send(n)}},{key:"getView",value:function(e,t){this.ajax({type:"GET",url:e,success:function(e){t(e)}})}}]),e}(),Json=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"sObject",value:function(e){var t="";for(var n in e)""!=t&&(t+="&"),t+=n+"="+encodeURIComponent(e[n]);return t}},{key:"hasProps",value:function(e,t){return!(!e[t]||""==e[t])}}]),e}(),Element=function(){function t(e){_classCallCheck(this,t),this._router=e}return _createClass(t,[{key:"scriptInit",value:function(e){var t=this._router;document.querySelectorAll("script").forEach(function(e){e.getAttribute("src")==t._ls&&e.parentNode.removeChild(e)}),void 0!==e&&(t._body.appendChild(this.createScript(e)),t._ls=e)}},{key:"createScript",value:function(e){var t=document.createElement("script");return t.src=e,t}}]),t}(),Helpers=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"characterCheck",value:function(e,t){return-1<e.indexOf(t)}},{key:"numCharactes",value:function(e,t){return(e.match(RegExp(t,"g"))||[]).length}},{key:"characterCheckRemove",value:function(e,t){return this.characterCheck(e,t)&&(e=e.replace(t,"")),e}},{key:"slashRemove",value:function(e){return this.characterCheck(e,"/")&&(e=e.replace(/\//g,"")),e}}]),e}();